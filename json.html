<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高级JSON对比工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script defer src="https://analytics.123408.xyz/tracker.min.js" data-website-id="123xiao-高级JSON对比工具"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                    },
                    fontFamily: {
                        mono: ['Consolas', 'Monaco', 'monospace']
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .node-selected {
                background-color: rgba(59, 130, 246, 0.2);
                border-radius: 4px;
            }
            .node-located {
                background-color: rgba(16, 185, 129, 0.2);
                border-left: 3px solid #10B981;
            }
            .node-highlight {
                animation: pulse 1.5s infinite;
            }
            @keyframes pulse {
                0% { background-color: rgba(59, 130, 246, 0.1); }
                50% { background-color: rgba(59, 130, 246, 0.3); }
                100% { background-color: rgba(59, 130, 246, 0.1); }
            }
            .scrollbar-thin {
                scrollbar-width: thin;
            }
            .scrollbar-thin::-webkit-scrollbar {
                width: 6px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb {
                background-color: rgba(156, 163, 175, 0.5);
                border-radius: 3px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen flex flex-col">
    <!-- 顶部导航 -->
    <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-code-fork text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-primary">高级JSON对比工具</h1>
            </div>
            <div class="flex items-center space-x-3">
                <a href="https://github.com/123xiao/geek-dev-personal-site" target="_blank" rel="noopener noreferrer" 
                   class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
                   title="GitHub开源地址">
                    <i class="fa fa-github text-gray-600 dark:text-gray-300 text-xl"></i>
                </a>
                <button id="help-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
                        title="使用帮助">
                    <i class="fa fa-question-circle text-gray-600 dark:text-gray-300"></i>
                </button>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
                        title="切换主题">
                    <i class="fa fa-moon-o dark:hidden text-gray-600"></i>
                    <i class="fa fa-sun-o hidden dark:block text-yellow-300"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-6 flex-grow">
        <!-- 功能按钮 -->
        <div class="flex flex-wrap gap-3 mb-6">
            <button id="load-sample" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center">
                <i class="fa fa-file-text-o mr-2"></i>加载示例
            </button>
            <button id="format-json1" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg flex items-center">
                <i class="fa fa-indent mr-2"></i>格式化JSON 1
            </button>
            <button id="format-json2" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg flex items-center">
                <i class="fa fa-indent mr-2"></i>格式化JSON 2
            </button>
            <button id="compare-btn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-2 rounded-lg flex items-center ml-auto">
                <i class="fa fa-exchange mr-2"></i>对比JSON
            </button>
        </div>

        <!-- 视图切换 -->
        <div class="mb-4 border-b border-gray-200 dark:border-gray-700">
            <ul class="flex -mb-px">
                <li>
                    <button id="text-view-tab" class="py-2 px-4 border-b-2 border-primary text-primary font-medium">
                        <i class="fa fa-code mr-1"></i>文本视图
                    </button>
                </li>
                <li>
                    <button id="tree-view-tab" class="py-2 px-4 border-b-2 border-transparent hover:text-gray-600 dark:hover:text-gray-300 font-medium">
                        <i class="fa fa-sitemap mr-1"></i>树形视图
                    </button>
                </li>
            </ul>
        </div>

        <!-- 树形视图控制按钮 -->
        <div id="tree-controls" class="mb-4 flex gap-2 hidden">
            <button id="expand-all" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-sm px-3 py-1 rounded flex items-center">
                <i class="fa fa-plus-square-o mr-1"></i>全部展开
            </button>
            <button id="collapse-all" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-sm px-3 py-1 rounded flex items-center">
                <i class="fa fa-minus-square-o mr-1"></i>全部折叠
            </button>
        </div>

        <!-- 选中路径显示 -->
        <div id="selected-path-container" class="mb-4 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg hidden">
            <div class="flex items-center">
                <i class="fa fa-link text-primary mr-2"></i>
                <span class="text-sm mr-2">选中路径:</span>
                <span id="selected-path" class="font-mono text-sm flex-grow truncate"></span>
                <button id="compare-selected-btn" class="ml-2 text-xs bg-secondary hover:bg-secondary/90 text-white px-3 py-1 rounded">
                    对比此路径
                </button>
            </div>
        </div>

        <!-- JSON输入区域 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- JSON 1 -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                <div class="bg-gray-100 dark:bg-gray-700 px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="font-medium flex items-center">
                        <span class="w-3 h-3 bg-primary rounded-full mr-2"></span>
                        JSON 1 (原始数据)
                    </h2>
                </div>
                
                <!-- 文本视图 -->
                <div class="json-text-view">
                    <textarea id="json1" class="w-full h-96 p-3 bg-gray-50 dark:bg-gray-900 border-0 focus:ring-1 focus:ring-primary resize-none scrollbar-thin font-mono text-sm" placeholder='请输入JSON数据'></textarea>
                    <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800/50">
                        <span id="json1-status"><i class="fa fa-info-circle mr-1"></i> 请输入有效的JSON</span>
                    </div>
                </div>
                
                <!-- 树形视图 -->
                <div class="json-tree-view hidden">
                    <div class="p-3 h-96 overflow-auto scrollbar-thin bg-gray-50 dark:bg-gray-900">
                        <div id="json1-tree" class="font-mono text-sm"></div>
                    </div>
                    <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800/50">
                        <span><i class="fa fa-info-circle mr-1"></i> 点击节点选择，箭头展开/折叠，右键可操作</span>
                    </div>
                </div>
            </div>

            <!-- JSON 2 -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                <div class="bg-gray-100 dark:bg-gray-700 px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="font-medium flex items-center">
                        <span class="w-3 h-3 bg-secondary rounded-full mr-2"></span>
                        JSON 2 (修改后数据)
                    </h2>
                </div>
                
                <!-- 文本视图 -->
                <div class="json-text-view">
                    <textarea id="json2" class="w-full h-96 p-3 bg-gray-50 dark:bg-gray-900 border-0 focus:ring-1 focus:ring-secondary resize-none scrollbar-thin font-mono text-sm" placeholder='请输入JSON数据'></textarea>
                    <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800/50">
                        <span id="json2-status"><i class="fa fa-info-circle mr-1"></i> 请输入有效的JSON</span>
                    </div>
                </div>
                
                <!-- 树形视图 -->
                <div class="json-tree-view hidden">
                    <div class="p-3 h-96 overflow-auto scrollbar-thin bg-gray-50 dark:bg-gray-900">
                        <div id="json2-tree" class="font-mono text-sm"></div>
                    </div>
                    <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800/50">
                        <span><i class="fa fa-info-circle mr-1"></i> 点击节点选择，箭头展开/折叠，右键可操作</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 对比结果 -->
        <div id="results-container" class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden hidden">
            <div class="bg-gray-100 dark:bg-gray-700 px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h2 class="font-medium">对比结果</h2>
                <div class="flex items-center">
                    <span id="differences-count" class="text-sm px-2 py-1 bg-gray-200 dark:bg-gray-600 rounded-full mr-3"></span>
                    <button id="copy-results" class="text-sm text-primary hover:text-primary/80">
                        <i class="fa fa-copy mr-1"></i>复制结果
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-800">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/4">字段路径</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-3/8">JSON 1 值</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-3/8">JSON 2 值</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                        </tr>
                    </thead>
                    <tbody id="differences-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        <!-- 结果将动态生成 -->
                    </tbody>
                </table>
            </div>
            
            <div id="no-differences" class="py-12 text-center hidden">
                <i class="fa fa-check-circle text-secondary text-5xl mb-4"></i>
                <p>两个JSON数据完全一致</p>
            </div>
        </div>

        <!-- 功能使用说明 -->
        <div class="mt-10 bg-white dark:bg-gray-800 rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fa fa-book text-primary mr-2"></i>功能使用说明
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <i class="fa fa-edit text-primary mr-2"></i>基础操作
                    </h3>
                    <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>在文本视图中输入或粘贴JSON数据，系统会自动验证格式</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>点击"格式化"按钮可美化JSON代码，提高可读性</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>点击"加载示例"可快速填充演示数据，了解工具功能</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>点击"对比JSON"按钮可对两个JSON进行完整对比</span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <i class="fa fa-sitemap text-primary mr-2"></i>树形视图功能
                    </h3>
                    <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>树形视图默认全部展开，可清晰查看JSON层级结构</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>使用"全部展开/折叠"按钮可快速控制所有节点显示状态</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>点击任意节点可选中，选中节点会显示浅蓝色背景</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>右键点击节点可弹出菜单，支持复制值、复制路径和对比节点</span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <i class="fa fa-exchange text-primary mr-2"></i>对比功能
                    </h3>
                    <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>完整对比：点击"对比JSON"按钮，比较两个JSON的所有差异</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>局部对比：选中节点后点击"对比此路径"，只比较该节点及其子节点</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>差异结果分为三类：新增（绿色）、删除（黄色）、修改（红色）</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>点击结果表格中的行，可在树形视图中定位到对应节点</span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <i class="fa fa-copy text-primary mr-2"></i>复制功能
                    </h3>
                    <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>复制值：复制选中节点的完整内容，对象/数组会格式化为JSON</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>复制路径：复制节点在JSON中的完整路径，如"users[0].details.age"</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>复制结果：将对比结果表格内容复制为文本格式，便于分享</span>
                        </li>
                        <li class="flex">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>所有复制操作都会有成功提示，确保操作有效</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fa fa-lightbulb-o text-warning mr-2"></i>使用技巧
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 text-gray-700 dark:text-gray-300">
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded">
                        <p class="text-sm"><i class="fa fa-star text-warning mr-1"></i> 处理大型JSON时，建议使用树形视图进行局部对比，提高效率</p>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded">
                        <p class="text-sm"><i class="fa fa-star text-warning mr-1"></i> 对比结果中的路径可直接用于定位相关节点，便于查看上下文</p>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded">
                        <p class="text-sm"><i class="fa fa-star text-warning mr-1"></i> 切换深色/浅色主题可根据使用环境调整，保护视力</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-8 mt-10">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-code-fork text-primary mr-2"></i>高级JSON对比工具
                    </h3>
                    <p class="text-gray-400 text-sm">
                        一款功能强大、操作便捷的JSON对比工具，支持完整对比和局部对比，
                        提供树形视图和文本视图两种查看方式，帮助开发者快速定位和分析JSON数据差异。
                    </p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">功能特性</h3>
                    <ul class="space-y-2 text-gray-400 text-sm">
                        <li class="flex items-center">
                            <i class="fa fa-check text-secondary mr-2"></i>
                            <span>JSON格式验证与格式化</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fa fa-check text-secondary mr-2"></i>
                            <span>完整对比与局部对比</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fa fa-check text-secondary mr-2"></i>
                            <span>树形视图与文本视图切换</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fa fa-check text-secondary mr-2"></i>
                            <span>节点定位与快速导航</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fa fa-check text-secondary mr-2"></i>
                            <span>深色/浅色主题切换</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">资源链接</h3>
                    <ul class="space-y-2 text-gray-400 text-sm">
                        <li class="flex items-center">
                            <i class="fa fa-github text-gray-300 mr-2"></i>
                            <a href="https://github.com/123xiao/geek-dev-personal-site" target="_blank" rel="noopener noreferrer" class="hover:text-primary transition-colors">GitHub 仓库</a>
                        </li>
                        <li class="flex items-center">
                            <i class="fa fa-book text-gray-300 mr-2"></i>
                            <a href="#" class="hover:text-primary transition-colors">使用文档</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-700 text-center text-gray-500 text-sm">
                <p>© 2025 高级JSON对比工具 | 开源项目 | MIT 许可协议</p>
                <p class="mt-2">本工具完全免费，源代码托管于GitHub，欢迎贡献代码和反馈问题</p>
            </div>
        </div>
    </footer>

    <!-- 右键菜单 -->
    <div id="context-menu" class="fixed z-50 hidden bg-white dark:bg-gray-800 shadow-lg rounded border border-gray-200 dark:border-gray-700 w-48">
        <ul class="py-1">
            <li><a href="#" id="ctx-copy-value" class="block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700">复制值</a></li>
            <li><a href="#" id="ctx-copy-path" class="block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700">复制路径</a></li>
            <li><a href="#" id="ctx-compare" class="block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700">对比此节点</a></li>
        </ul>
    </div>

    <!-- 帮助模态框 -->
    <div id="help-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div class="bg-gray-100 dark:bg-gray-700 px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-xl font-bold">使用帮助</h3>
                <button id="close-help" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="space-y-6">
                    <div>
                        <h4 class="text-lg font-semibold mb-3">基本功能</h4>
                        <p class="text-gray-700 dark:text-gray-300 mb-3">
                            本工具用于对比两个JSON数据的差异，支持完整对比和局部对比，提供直观的结果展示。
                        </p>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700 dark:text-gray-300">
                            <li>在左侧文本框输入原始JSON数据（JSON 1）</li>
                            <li>在右侧文本框输入修改后的JSON数据（JSON 2）</li>
                            <li>点击"对比JSON"按钮查看完整差异</li>
                            <li>或切换到树形视图，选择特定节点进行局部对比</li>
                        </ol>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-3">树形视图操作</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 dark:text-gray-300">
                            <li>默认全部展开，可查看完整JSON结构</li>
                            <li>点击节点前的箭头可单独展开/折叠该节点</li>
                            <li>使用"全部展开/折叠"按钮控制所有节点</li>
                            <li>点击节点可选中，选中节点会高亮显示</li>
                            <li>右键点击节点可弹出操作菜单</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-3">对比结果说明</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 dark:text-gray-300">
                            <li><span class="inline-block px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 rounded text-xs">新增</span>：JSON 2中新增的字段</li>
                            <li><span class="inline-block px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 rounded text-xs">删除</span>：JSON 1中有但JSON 2中删除的字段</li>
                            <li><span class="inline-block px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 rounded text-xs">修改</span>：两个JSON中都存在但值不同的字段</li>
                            <li>点击结果行可在树形视图中定位到对应节点</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-4 right-4 px-4 py-2 rounded shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50"></div>

    <script>
        // 全局状态
        let json1 = {};
        let json2 = {};
        let selectedNode = null;
        let nodeRegistry = { json1: {}, json2: {} }; // 存储所有节点信息

        // DOM元素
        const json1Input = document.getElementById('json1');
        const json2Input = document.getElementById('json2');
        const json1Status = document.getElementById('json1-status');
        const json2Status = document.getElementById('json2-status');
        const json1Tree = document.getElementById('json1-tree');
        const json2Tree = document.getElementById('json2-tree');
        const textViewTab = document.getElementById('text-view-tab');
        const treeViewTab = document.getElementById('tree-view-tab');
        const compareBtn = document.getElementById('compare-btn');
        const compareSelectedBtn = document.getElementById('compare-selected-btn');
        const selectedPathContainer = document.getElementById('selected-path-container');
        const selectedPathElement = document.getElementById('selected-path');
        const resultsContainer = document.getElementById('results-container');
        const differencesTable = document.getElementById('differences-table');
        const differencesCount = document.getElementById('differences-count');
        const noDifferences = document.getElementById('no-differences');
        const contextMenu = document.getElementById('context-menu');
        const ctxCopyValue = document.getElementById('ctx-copy-value');
        const ctxCopyPath = document.getElementById('ctx-copy-path');
        const ctxCompare = document.getElementById('ctx-compare');
        const notification = document.getElementById('notification');
        const themeToggle = document.getElementById('theme-toggle');
        const loadSampleBtn = document.getElementById('load-sample');
        const formatJson1Btn = document.getElementById('format-json1');
        const formatJson2Btn = document.getElementById('format-json2');
        const copyResultsBtn = document.getElementById('copy-results');
        const treeControls = document.getElementById('tree-controls');
        const expandAllBtn = document.getElementById('expand-all');
        const collapseAllBtn = document.getElementById('collapse-all');
        const helpBtn = document.getElementById('help-btn');
        const helpModal = document.getElementById('help-modal');
        const closeHelpBtn = document.getElementById('close-help');

        // 初始化
        function init() {
            // 加载示例数据
            loadSampleData();
            
            // 验证并解析JSON
            validateAndParseJson(json1Input, json1Status, (data) => json1 = data);
            validateAndParseJson(json2Input, json2Status, (data) => json2 = data);
            
            // 渲染树形结构
            renderTrees();
            
            // 初始化主题
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            
            // 事件监听
            setupEventListeners();
        }

        // 设置所有事件监听
        function setupEventListeners() {
            // 视图切换
            textViewTab.addEventListener('click', () => switchView('text'));
            treeViewTab.addEventListener('click', () => switchView('tree'));
            
            // 树形视图控制按钮
            expandAllBtn.addEventListener('click', expandAllNodes);
            collapseAllBtn.addEventListener('click', collapseAllNodes);
            
            // JSON输入变化
            json1Input.addEventListener('input', () => {
                validateAndParseJson(json1Input, json1Status, (data) => {
                    json1 = data;
                    renderTrees();
                });
            });
            
            json2Input.addEventListener('input', () => {
                validateAndParseJson(json2Input, json2Status, (data) => {
                    json2 = data;
                    renderTrees();
                });
            });
            
            // 按钮事件
            compareBtn.addEventListener('click', () => compareJson(''));
            compareSelectedBtn.addEventListener('click', () => {
                if (selectedNode) compareJson(selectedNode.path);
                else showNotification('请先选择一个节点', 'warning');
            });
            
            loadSampleBtn.addEventListener('click', loadSampleData);
            formatJson1Btn.addEventListener('click', () => formatJson(json1Input));
            formatJson2Btn.addEventListener('click', () => formatJson(json2Input));
            copyResultsBtn.addEventListener('click', copyResults);
            
            // 帮助模态框
            helpBtn.addEventListener('click', () => helpModal.classList.remove('hidden'));
            closeHelpBtn.addEventListener('click', () => helpModal.classList.add('hidden'));
            helpModal.addEventListener('click', (e) => {
                if (e.target === helpModal) helpModal.classList.add('hidden');
            });
            
            // 右键菜单事件
            ctxCopyValue.addEventListener('click', (e) => {
                e.preventDefault();
                if (selectedNode) copyNodeValue(selectedNode);
                contextMenu.classList.add('hidden');
            });
            
            ctxCopyPath.addEventListener('click', (e) => {
                e.preventDefault();
                if (selectedNode) copyNodePath(selectedNode);
                contextMenu.classList.add('hidden');
            });
            
            ctxCompare.addEventListener('click', (e) => {
                e.preventDefault();
                if (selectedNode) compareJson(selectedNode.path);
                contextMenu.classList.add('hidden');
            });
            
            // 点击空白处关闭右键菜单
            document.addEventListener('click', (e) => {
                if (!contextMenu.contains(e.target) && !e.target.closest('.json-node')) {
                    contextMenu.classList.add('hidden');
                }
            });
            
            // 主题切换
            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                // 保存主题偏好
                if (document.documentElement.classList.contains('dark')) {
                    localStorage.theme = 'dark';
                } else {
                    localStorage.theme = 'light';
                }
            });
        }

        // 切换视图模式
        function switchView(viewType) {
            const textViews = document.querySelectorAll('.json-text-view');
            const treeViews = document.querySelectorAll('.json-tree-view');
            
            if (viewType === 'text') {
                textViews.forEach(el => el.classList.remove('hidden'));
                treeViews.forEach(el => el.classList.add('hidden'));
                textViewTab.classList.add('border-primary', 'text-primary');
                textViewTab.classList.remove('border-transparent');
                treeViewTab.classList.remove('border-primary', 'text-primary');
                treeViewTab.classList.add('border-transparent');
                treeControls.classList.add('hidden');
            } else {
                textViews.forEach(el => el.classList.add('hidden'));
                treeViews.forEach(el => el.classList.remove('hidden'));
                treeViewTab.classList.add('border-primary', 'text-primary');
                treeViewTab.classList.remove('border-transparent');
                textViewTab.classList.remove('border-primary', 'text-primary');
                textViewTab.classList.add('border-transparent');
                treeControls.classList.remove('hidden');
                
                // 确保树形视图已渲染并全部展开
                renderTrees();
                expandAllNodes();
            }
        }

        // 展开所有节点
        function expandAllNodes() {
            // 展开所有节点
            document.querySelectorAll('.json-children.hidden').forEach(children => {
                children.classList.remove('hidden');
                const toggleIcon = children.previousElementSibling.querySelector('.toggle-icon i');
                if (toggleIcon) toggleIcon.classList.add('rotate-90');
            });
            showNotification('所有节点已展开', 'info');
        }

        // 折叠所有节点
        function collapseAllNodes() {
            // 折叠所有节点（保留顶层）
            document.querySelectorAll('.json-children:not(.hidden)').forEach(children => {
                // 只折叠非顶层节点
                if (children.closest('.json-tree').classList.contains('pl-4')) {
                    children.classList.add('hidden');
                    const toggleIcon = children.previousElementSibling.querySelector('.toggle-icon i');
                    if (toggleIcon) toggleIcon.classList.remove('rotate-90');
                }
            });
            showNotification('所有节点已折叠', 'info');
        }

        // 验证并解析JSON
        function validateAndParseJson(inputElement, statusElement, callback) {
            try {
                const value = inputElement.value.trim();
                if (!value) {
                    statusElement.innerHTML = '<i class="fa fa-info-circle mr-1"></i> 请输入JSON数据';
                    statusElement.className = 'text-gray-500';
                    callback({});
                    return false;
                }
                
                const parsed = JSON.parse(value);
                statusElement.innerHTML = '<i class="fa fa-check-circle mr-1 text-green-500"></i> JSON格式有效';
                statusElement.className = 'text-green-500';
                callback(parsed);
                return true;
            } catch (error) {
                statusElement.innerHTML = `<i class="fa fa-exclamation-circle mr-1 text-red-500"></i> 格式错误: ${error.message}`;
                statusElement.className = 'text-red-500';
                callback({});
                return false;
            }
        }

        // 渲染树形结构
        function renderTrees() {
            // 重置节点注册表
            nodeRegistry.json1 = {};
            nodeRegistry.json2 = {};
            
            // 渲染两个JSON的树形结构
            json1Tree.innerHTML = renderTree(json1, 'json1', '');
            json2Tree.innerHTML = renderTree(json2, 'json2', '');
            
            // 为所有节点添加事件监听
            attachNodeEvents('json1');
            attachNodeEvents('json2');
            
            // 默认展开所有节点
            if (!document.querySelectorAll('.json-tree-view.hidden').length) {
                expandAllNodes();
            }
        }

        // 渲染单个树形结构
        function renderTree(data, source, path) {
            if (data === null) {
                return `<div class="json-node-leaf pl-6">null</div>`;
            }
            
            // 对于非对象/数组类型，直接返回值
            if (typeof data !== 'object' || data === null) {
                return `<div class="json-node-leaf pl-6">${formatValue(data)}</div>`;
            }
            
            const isArray = Array.isArray(data);
            const items = isArray ? data : Object.entries(data);
            const nodeId = `node-${source}-${path.replace(/[.[\]']/g, '-')}`;
            
            let html = `<ul class="json-tree ${path ? 'pl-4' : ''}">`;
            
            for (let i = 0; i < items.length; i++) {
                const key = isArray ? i : items[i][0];
                const value = isArray ? items[i] : items[i][1];
                const isComplex = typeof value === 'object' && value !== null;
                
                // 构建完整路径
                let itemPath;
                if (path === '') {
                    itemPath = isArray ? `[${key}]` : key;
                } else {
                    itemPath = isArray ? `${path}[${key}]` : `${path}.${key}`;
                }
                
                // 注册节点信息
                nodeRegistry[source][itemPath] = {
                    id: `${nodeId}-${key}`,
                    value: value,
                    path: itemPath
                };
                
                // 节点类型图标
                const typeIcon = getTypeIcon(value);
                
                // 节点HTML
                html += `
                <li class="json-node-item" data-source="${source}" data-path="${itemPath}" id="${nodeId}-${key}">
                    <div class="json-node flex items-center py-1 px-2 cursor-pointer">
                        ${isComplex ? `
                            <span class="toggle-icon mr-2 text-gray-500 transition-transform">
                                <i class="fa fa-caret-right"></i>
                            </span>
                        ` : '<span class="w-5 mr-2"></span>'}
                        <span class="json-key ${isArray ? 'text-gray-500' : ''}">${isArray ? `[${key}]` : key}:</span>
                        <span class="json-value ml-1">${typeIcon}${formatValuePreview(value)}</span>
                    </div>
                    ${isComplex ? `
                        <div class="json-children">
                            ${renderTree(value, source, itemPath)}
                        </div>
                    ` : ''}
                </li>
                `;
            }
            
            html += '</ul>';
            return html;
        }

        // 为节点添加事件监听
        function attachNodeEvents(source) {
            // 获取所有节点
            const nodes = document.querySelectorAll(`.json-node-item[data-source="${source}"]`);
            
            nodes.forEach(node => {
                const nodeElement = node.querySelector('.json-node');
                const toggleIcon = node.querySelector('.toggle-icon');
                const children = node.querySelector('.json-children');
                const path = node.dataset.path;
                
                // 展开/折叠事件
                if (toggleIcon && children) {
                    toggleIcon.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleIcon.querySelector('i').classList.toggle('rotate-90');
                        children.classList.toggle('hidden');
                    });
                }
                
                // 节点选择事件
                nodeElement.addEventListener('click', () => {
                    // 移除之前的选择状态
                    document.querySelectorAll('.json-node').forEach(n => {
                        n.classList.remove('node-selected');
                    });
                    
                    // 设置新的选择状态
                    nodeElement.classList.add('node-selected');
                    
                    // 更新选中节点信息
                    selectedNode = {
                        source: source,
                        path: path,
                        value: nodeRegistry[source][path].value
                    };
                    
                    // 显示选中路径
                    selectedPathElement.textContent = path;
                    selectedPathContainer.classList.remove('hidden');
                });
                
                // 右键菜单
                nodeElement.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    
                    // 选中当前节点
                    nodeElement.click();
                    
                    // 显示右键菜单
                    contextMenu.style.top = `${e.pageY}px`;
                    contextMenu.style.left = `${e.pageX}px`;
                    contextMenu.classList.remove('hidden');
                });
            });
        }

        // 获取值类型图标
        function getTypeIcon(value) {
            if (value === null) return '<i class="fa fa-ban text-gray-500 mr-1"></i>';
            if (Array.isArray(value)) return '<i class="fa fa-list text-green-500 mr-1"></i>';
            if (typeof value === 'object') return '<i class="fa fa-object-group text-blue-500 mr-1"></i>';
            if (typeof value === 'string') return '<i class="fa fa-quote-right text-yellow-500 mr-1"></i>';
            if (typeof value === 'number') return '<i class="fa fa-hashtag text-purple-500 mr-1"></i>';
            if (typeof value === 'boolean') return '<i class="fa fa-check text-green-500 mr-1"></i>';
            return '';
        }

        // 格式化值的预览
        function formatValuePreview(value) {
            if (value === null) return '<span class="text-gray-500">null</span>';
            if (typeof value === 'string') return `<span class="text-yellow-600">"${escapeHtml(value.substring(0, 20))}${value.length > 20 ? '...' : ''}"</span>`;
            if (typeof value === 'number') return `<span class="text-purple-600">${value}</span>`;
            if (typeof value === 'boolean') return `<span class="text-green-600">${value}</span>`;
            if (Array.isArray(value)) return `<span class="text-gray-500">数组 (${value.length} 项)</span>`;
            if (typeof value === 'object') return `<span class="text-gray-500">对象 (${Object.keys(value).length} 个属性)</span>`;
            return escapeHtml(String(value));
        }

        // 格式化完整值
        function formatValue(value) {
            if (value === null) return '<span class="text-gray-500">null</span>';
            if (typeof value === 'string') return `<span class="text-yellow-600">"${escapeHtml(value)}"</span>`;
            if (typeof value === 'number') return `<span class="text-purple-600">${value}</span>`;
            if (typeof value === 'boolean') return `<span class="text-green-600">${value}</span>`;
            return escapeHtml(String(value));
        }

        // 根据路径获取JSON中的值
        function getValueByPath(obj, path) {
            try {
                let current = obj;
                const parts = path.match(/([^.[\]]+)|(\[\d+\])/g);
                
                if (!parts) return undefined;
                
                for (const part of parts) {
                    if (part.startsWith('[')) {
                        // 处理数组索引
                        const index = parseInt(part.slice(1, -1));
                        if (Array.isArray(current) && index >= 0 && index < current.length) {
                            current = current[index];
                        } else {
                            return undefined;
                        }
                    } else {
                        // 处理对象属性
                        if (current && typeof current === 'object' && part in current) {
                            current = current[part];
                        } else {
                            return undefined;
                        }
                    }
                }
                
                return current;
            } catch (error) {
                console.error('获取路径值失败:', error);
                return undefined;
            }
        }

        // 获取所有路径及其值
        function getAllPaths(obj, basePath = '') {
            const result = {};
            
            function traverse(currentObj, currentPath) {
                if (currentObj === null) {
                    result[currentPath] = null;
                    return;
                }
                
                if (typeof currentObj !== 'object') {
                    result[currentPath] = currentObj;
                    return;
                }
                
                if (Array.isArray(currentObj)) {
                    currentObj.forEach((item, index) => {
                        const newPath = currentPath ? `${currentPath}[${index}]` : `[${index}]`;
                        traverse(item, newPath);
                    });
                } else {
                    for (const key in currentObj) {
                        if (currentObj.hasOwnProperty(key)) {
                            const newPath = currentPath ? `${currentPath}.${key}` : key;
                            traverse(currentObj[key], newPath);
                        }
                    }
                }
            }
            
            traverse(obj, basePath);
            return result;
        }

        // 对比JSON
        function compareJson(path = '') {
            // 验证JSON有效性
            const isJson1Valid = validateAndParseJson(json1Input, json1Status, (data) => json1 = data);
            const isJson2Valid = validateAndParseJson(json2Input, json2Status, (data) => json2 = data);
            
            if (!isJson1Valid || !isJson2Valid) {
                showNotification('请先输入有效的JSON数据', 'error');
                return;
            }
            
            try {
                let obj1, obj2;
                let basePath = '';
                
                // 如果指定了路径，只对比该路径下的内容
                if (path) {
                    obj1 = getValueByPath(json1, path);
                    obj2 = getValueByPath(json2, path);
                    basePath = path;
                    
                    // 检查路径是否存在
                    if (obj1 === undefined && obj2 === undefined) {
                        showNotification(`路径 "${path}" 在两个JSON中都不存在`, 'error');
                        return;
                    }
                    if (obj1 === undefined) {
                        showNotification(`路径 "${path}" 在JSON 1中不存在`, 'error');
                        return;
                    }
                    if (obj2 === undefined) {
                        showNotification(`路径 "${path}" 在JSON 2中不存在`, 'error');
                        return;
                    }
                } else {
                    // 对比整个JSON
                    obj1 = json1;
                    obj2 = json2;
                }
                
                // 获取所有路径
                const paths1 = getAllPaths(obj1, basePath);
                const paths2 = getAllPaths(obj2, basePath);
                
                // 找出所有差异
                const allPaths = new Set([...Object.keys(paths1), ...Object.keys(paths2)]);
                const differences = [];
                
                allPaths.forEach(path => {
                    const value1 = paths1[path];
                    const value2 = paths2[path];
                    
                    if (!paths1.hasOwnProperty(path)) {
                        // 新增
                        differences.push({ path, value1: null, value2, status: 'added' });
                    } else if (!paths2.hasOwnProperty(path)) {
                        // 删除
                        differences.push({ path, value1, value2: null, status: 'removed' });
                    } else if (JSON.stringify(value1) !== JSON.stringify(value2)) {
                        // 修改
                        differences.push({ path, value1, value2, status: 'modified' });
                    }
                });
                
                // 显示结果
                displayDifferences(differences);
                
            } catch (error) {
                showNotification(`对比失败: ${error.message}`, 'error');
                console.error(error);
            }
        }

        // 显示差异结果
        function displayDifferences(differences) {
            // 清空表格
            differencesTable.innerHTML = '';
            
            // 更新计数
            differencesCount.textContent = `${differences.length} 处差异`;
            
            // 显示/隐藏无差异提示
            if (differences.length === 0) {
                noDifferences.classList.remove('hidden');
            } else {
                noDifferences.classList.add('hidden');
                
                // 添加差异行
                differences.forEach(diff => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700/50';
                    row.dataset.path = diff.path;
                    
                    // 点击行定位到对应节点
                    row.addEventListener('click', () => {
                        switchView('tree');
                        locateNode('json1', diff.path);
                        locateNode('json2', diff.path);
                    });
                    
                    // 状态样式
                    let statusClass, statusText;
                    switch (diff.status) {
                        case 'modified':
                            statusClass = 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400';
                            statusText = '修改';
                            break;
                        case 'added':
                            statusClass = 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400';
                            statusText = '新增';
                            break;
                        case 'removed':
                            statusClass = 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400';
                            statusText = '删除';
                            break;
                    }
                    
                    // 格式化值显示
                    const formatCellValue = (value) => {
                        if (value === null) return '<span class="text-gray-400 italic">无</span>';
                        if (typeof value === 'object') {
                            return `<pre class="text-sm whitespace-pre-wrap">${JSON.stringify(value, null, 2)}</pre>`;
                        }
                        return formatValue(value);
                    };
                    
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">${diff.path}</td>
                        <td class="px-4 py-3 text-sm">${formatCellValue(diff.value1)}</td>
                        <td class="px-4 py-3 text-sm">${formatCellValue(diff.value2)}</td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${statusText}</span>
                        </td>
                    `;
                    
                    differencesTable.appendChild(row);
                });
            }
            
            // 显示结果容器
            resultsContainer.classList.remove('hidden');
            
            // 滚动到结果区域
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // 定位节点
        function locateNode(source, path) {
            // 清除所有定位状态
            document.querySelectorAll(`.json-node-item[data-source="${source}"] .json-node`).forEach(node => {
                node.classList.remove('node-located');
            });
            
            // 查找节点
            if (nodeRegistry[source][path]) {
                const nodeId = nodeRegistry[source][path].id;
                const nodeItem = document.getElementById(nodeId);
                
                if (nodeItem) {
                    const nodeElement = nodeItem.querySelector('.json-node');
                    const children = nodeItem.querySelector('.json-children');
                    const toggleIcon = nodeItem.querySelector('.toggle-icon i');
                    
                    // 展开所有父节点
                    let current = nodeItem.parentElement;
                    while (current && current.classList.contains('json-children')) {
                        current.classList.remove('hidden');
                        const parentToggle = current.previousElementSibling.querySelector('.toggle-icon i');
                        if (parentToggle) parentToggle.classList.add('rotate-90');
                        current = current.parentElement.parentElement;
                    }
                    
                    // 如果有子节点且处于折叠状态，展开它
                    if (children && children.classList.contains('hidden') && toggleIcon) {
                        toggleIcon.classList.add('rotate-90');
                        children.classList.remove('hidden');
                    }
                    
                    // 高亮显示节点
                    nodeElement.classList.add('node-located');
                    
                    // 滚动到节点
                    nodeElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    return true;
                }
            }
            
            return false;
        }

        // 复制节点值
        function copyNodeValue(node) {
            try {
                // 对于对象和数组，复制格式化的JSON
                // 对于基本类型，直接复制值
                const value = typeof node.value === 'object' && node.value !== null
                    ? JSON.stringify(node.value, null, 2) 
                    : String(node.value);
                
                navigator.clipboard.writeText(value).then(() => {
                    const type = typeof node.value === 'object' && node.value !== null 
                        ? Array.isArray(node.value) ? '数组' : '对象' 
                        : '值';
                    showNotification(`${type}已复制`, 'success');
                });
            } catch (error) {
                showNotification('复制失败', 'error');
                console.error(error);
            }
        }

        // 复制节点路径
        function copyNodePath(node) {
            try {
                navigator.clipboard.writeText(node.path).then(() => {
                    showNotification('节点路径已复制', 'success');
                });
            } catch (error) {
                showNotification('复制失败', 'error');
                console.error(error);
            }
        }

        // 复制结果
        function copyResults() {
            let text = 'JSON对比结果:\n\n';
            
            if (noDifferences.classList.contains('hidden')) {
                const rows = differencesTable.querySelectorAll('tr');
                rows.forEach(row => {
                    const path = row.querySelector('td:first-child').textContent;
                    const value1 = row.querySelector('td:nth-child(2)').textContent.trim() || '无';
                    const value2 = row.querySelector('td:nth-child(3)').textContent.trim() || '无';
                    const status = row.querySelector('td:last-child span').textContent;
                    
                    text += `路径: ${path}\n状态: ${status}\nJSON 1: ${value1}\nJSON 2: ${value2}\n\n`;
                });
            } else {
                text += '两个JSON数据完全一致，没有差异';
            }
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification('结果已复制', 'success');
            }).catch(() => {
                showNotification('复制失败', 'error');
            });
        }

        // 格式化JSON
        function formatJson(inputElement) {
            try {
                const parsed = JSON.parse(inputElement.value.trim());
                inputElement.value = JSON.stringify(parsed, null, 2);
                showNotification('JSON已格式化', 'success');
                // 更新解析后的JSON
                if (inputElement.id === 'json1') {
                    json1 = parsed;
                } else {
                    json2 = parsed;
                }
                renderTrees();
            } catch (error) {
                showNotification(`格式化失败: ${error.message}`, 'error');
            }
        }

        // 加载示例数据
        function loadSampleData() {
            const sampleJson1 = {
                "name": "用户列表",
                "version": "1.0",
                "users": [
                    {
                        "id": 1,
                        "name": "张三",
                        "details": {
                            "age": 30,
                            "hobbies": ["阅读", "跑步"],
                            "address": {
                                "city": "北京",
                                "street": "科技路100号"
                            }
                        }
                    },
                    {
                        "id": 2,
                        "name": "李四",
                        "details": {
                            "age": 25,
                            "hobbies": ["游泳", "旅游"],
                            "address": {
                                "city": "上海",
                                "street": "南京东路50号"
                            }
                        }
                    }
                ]
            };

            const sampleJson2 = {
                "name": "用户列表",
                "version": "1.1",
                "users": [
                    {
                        "id": 1,
                        "name": "张三",
                        "details": {
                            "age": 31,
                            "hobbies": ["阅读", "跑步", "摄影"],
                            "address": {
                                "city": "北京",
                                "street": "科技路100号",
                                "zipcode": "100000"
                            },
                            "married": true
                        }
                    },
                    {
                        "id": 3,
                        "name": "王五",
                        "details": {
                            "age": 28,
                            "hobbies": ["编程", "篮球"],
                            "address": {
                                "city": "广州",
                                "street": "天河路200号"
                            }
                        }
                    }
                ],
                "updated": "2023-07-01"
            };

            json1Input.value = JSON.stringify(sampleJson1, null, 2);
            json2Input.value = JSON.stringify(sampleJson2, null, 2);
            
            // 更新解析后的JSON
            json1 = sampleJson1;
            json2 = sampleJson2;
            
            // 更新状态
            json1Status.innerHTML = '<i class="fa fa-check-circle mr-1 text-green-500"></i> JSON格式有效';
            json1Status.className = 'text-green-500';
            json2Status.innerHTML = '<i class="fa fa-check-circle mr-1 text-green-500"></i> JSON格式有效';
            json2Status.className = 'text-green-500';
            
            // 重新渲染树形结构
            renderTrees();
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            let bgColor, textColor, icon;
            
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-500';
                    textColor = 'text-white';
                    icon = 'fa-check-circle';
                    break;
                case 'error':
                    bgColor = 'bg-red-500';
                    textColor = 'text-white';
                    icon = 'fa-exclamation-circle';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-500';
                    textColor = 'text-white';
                    icon = 'fa-exclamation-triangle';
                    break;
                default:
                    bgColor = 'bg-blue-500';
                    textColor = 'text-white';
                    icon = 'fa-info-circle';
            }
            
            notification.className = `fixed bottom-4 right-4 px-4 py-2 rounded shadow-lg transform translate-y-0 opacity-100 transition-all duration-300 flex items-center z-50 ${bgColor} ${textColor}`;
            notification.innerHTML = `<i class="fa ${icon} mr-2"></i> ${message}`;
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.classList.remove('translate-y-0', 'opacity-100');
                notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // HTML转义
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe.toString()
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // 初始化应用
        init();
    </script>
</body>
</html>
    